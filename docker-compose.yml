services:
  p2p-manager:
    image: node:22-alpine
    working_dir: /app
    command: sh -c "corepack enable && pnpm install && pnpm p2p:dev"
    environment:
      NODE_ENV: development
    ports:
      - 3002:3002
    volumes:
      - .:/app
      - p2p_node_modules:/app/node_modules

  web:
    image: node:22-alpine
    working_dir: /app
    command:
      - sh
      - -c
      - corepack enable && pnpm install && pnpm web:dev
    environment:
      NODE_ENV: development
      VITE_API_BASE: http://localhost:3002
    ports:
      - 4200:4200
    depends_on:
      - p2p-manager
    volumes:
      - .:/app
      - web_node_modules:/app/node_modules

volumes:
  p2p_node_modules:
  web_node_modules:
